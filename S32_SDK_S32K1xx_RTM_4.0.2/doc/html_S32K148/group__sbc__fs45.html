<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>S32 SDK: System Basis Chip Driver (SBC) - FS45xx Family</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top" style="height:auto; width:100%"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <img id="projectlogo" style="height:auto; width:100%" alt="Logo" src="s32sdk_logo_small.jpg"/>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__sbc__fs45.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">System Basis Chip Driver (SBC) - FS45xx Family</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>System Basis Chip driver is a middleware driver for SBC settings and control. </p>
<h2>Hardware background</h2>
<p>The FS45xx system basis chip (SBC) family provides power to MCUs and optimizes energy consumption through DC/DC switching regulators, linear regulators, and ultra-low-power saving modes. Featuring advanced functional safety measures, serial peripheral interface (SPI) to allow control and diagnostics with the MCU, integration of CAN FD and LIN physical interfaces compliant with the ISO 11898-2,-5, LIN 2.2, 2.1/J2602-2 standards along with the latest automotive OEM standards for EMC and ESD, range of integrated safety features such as monitoring of critical analog parameters, a failsafe state machine, and an advanced watchdog reduce software complexity with dual-core lock-step MCUs.</p>
<h2>How to use SBC driver in your application</h2>
<p>In order to set up SBC device the user needs to configure <a class="el" href="structfs45__drv__config__t.html" title="Structure for FS45 driver configuration. ">fs45_drv_config_t</a> structure in which structures corresponding to individual init (configurable during initialization) and non-init (configuratble any time) registers are included. The <a class="el" href="structfs45__drv__config__t.html" title="Structure for FS45 driver configuration. ">fs45_drv_config_t</a> structure is passed as a parameter to Init function to initialize SBC device. The rest of the functions are related to individual featuers and registers.</p>
<h3>Initialization</h3>
<p>The initialization function is responsible for setting up the FS45xx, according to user configuration data which is passed as parameter. The initialization function takes another parameters which are an instance of SPI used for communication with the SBC and SPI timeout in milliseconds. The initialization function configures all SBC init registers and selected non-init registers.</p>
<h3>Writing to registers</h3>
<p>In order to write to registers, there are several functions dedicated to some specific registers. These functions (with name containing the word Set) take a value or a pointer to structure containing values to be written to particular registers as a parameter. Besides these methods there is also a generic function FS45_WriteRegister which is for writing to any register. It takes three parameters. The first one is an address of a register to be written. Addresses of registers are defined in <a class="el" href="sbc__fs45__map_8h.html">sbc_fs45_map.h</a>. The second argument is a value which should be sent to a register. The last argument is a pointer to structure for storing received diagnostics and data. NULL pointer can be used when received data should be ignored.</p>
<h3>Reading from registers</h3>
<p>Several methods to reading specific control and status register are available similarly to the register writing. Their names contain the word Get. Content of any register can be read by function FS45_ReadRegister. This function has two arguments. The first is an address of a register to be read from, the second is a pointer to a structure where the content of a register and diagnostic data will be stored. Addresses of registers are defined in <a class="el" href="sbc__fs45__map_8h.html">sbc_fs45_map.h</a>.</p>
<h3>Watchdog refresh</h3>
<p>The function FS45_WD_Refresh should be called periodically depending on watchdog window set. The function reads watchdog seed from the device, calculates the answer and writes it back to WD_ANSWER register.</p>
<h3>Low-power mode</h3>
<p>The device has two low-power modes which can be entered using the FS45_SetLowPowerMode function. Before entering LPOFF Sleep mode make sure some wake-up sources are enabled. The device can be woken up by physical layer (CAN, LIN), timer (LDT), or IOs (IO_0 is enabled as wake-up source by default). In LPOFF auto WU mode the device wakes up automatically after 1 ms, it allows restart of the state machine.</p>
<h3>Setting regulator state</h3>
<p>The function FS45_SetRegulatorState allows turning on and off of the device regulators. There are various voltage regulators for different purposes. VCORE is a high efficiency regulator for MCU. VCCA is used to provide accurate voltage output (5.0 or 3.3 V) to MCU IOs, mainly ADC. VAUX can be used to power other device in the ECU, or external sensors. VCAN is a power supply dedicated to CAN transceiver. VKAM provides keep alive memory supply in low-power mode. Note that disabling the regulators might result in loss of some functionality, based on the regulator type and your board design (for example loss of SPI communication, SPI MISO is powered by VDDIO internal regulator, which is usually supplied from VCORE or VCCA - depends on board connections).</p>
<h3>CAN and LIN transceivers mode</h3>
<p>The functions FS45_CAN_SetMode and FS45_LIN_SetMode allow transition of the CAN and LIN transceivers between various modes (normal, listen-only, sleep with/without wake-up capability) together with automatic transition to listen only mode when there is a fault. Transitions between the modes can alter the CAN/LIN frames currently being sent on the bus, a delay might need to be added to allow settling after the transition.</p>
<h3>Reading diagnostics</h3>
<p>There are various diagnostics registers containing status of the voltage regulators (DIAG_VPRE, DIAG_VCORE, DIAG_VCCA, DIAG_VAUX, DIAG_VSUP_VCAN), CAN/LIN (DIAG_CAN_FD, DIAG_CAN_LIN) and SPI (DIAG_SPI), as well as general diagnostics returned on MISO with every read and write command. FS45_ReadRegister can be used to gather the status.</p>
<h3>Error tracking</h3>
<p>If an error during the R/W operations to FS45xx registers occurs, the driver keeps track of it. If a function returns status different from STATUS_SUCCESS the status represents the type of error from status_t enum.</p>
<h2>Example code snippets (for DEVKIT-MPC5744P board).</h2>
<h3>SBC initialization</h3>
<p>This example source code snippet shows how to initialize the device. During initialization the device registers are written with values in the main configuration structure. The main register set is initialized only after power on reset. The first watchdog refresh is part of the initialization function, the SBC should be in NORMAL mode upon the function exit. After FS45_Init the watchdog refresh timer should be started with period set to 3/4 of the device watchdog period. </p><div class="fragment"><div class="line"><span class="comment">/* SPI timeout. */</span></div>
<div class="line"><span class="preprocessor">#define SPI_COMM_TIMEOUT_MS 5</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{  </div>
<div class="line">    <span class="comment">/* Status return code. */</span></div>
<div class="line">    <a class="code" href="status_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a> status = <a class="code" href="status_8h.html#af9bff8ff1154a04a899276af806b8586a83da0606125c0dc2fe0544cb2c383cb9">STATUS_SUCCESS</a>;</div>
<div class="line">    <span class="comment">/* Pointer to store default values of non-init registers. */</span></div>
<div class="line">    <a class="code" href="structfs45__reg__config__value__t.html">fs45_reg_config_value_t</a> nonInitConfig[5];</div>
<div class="line">    <span class="comment">/* Device configuration - if PEx is not used, otherwise the config is generated. */</span></div>
<div class="line">    <a class="code" href="structfs45__drv__config__t.html">fs45_drv_config_t</a> sbc_fs45_InitConfig;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* MCU peripherals initialization. */</span></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Get default values of init registers - if PEx is not used, otherwise the config is generated. */</span></div>
<div class="line">    <a class="code" href="group__sbc__fs45__driver.html#ga443a1436bcd7e4e1a94bbf89a778ca7a">FS45_GetDefaultInitRegsConfig</a>(&amp;sbc_fs45_InitConfig);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Change default init register values if needed. */</span></div>
<div class="line">    <span class="comment">/* Change default configuration when FCCU is not used. */</span></div>
<div class="line">    sbc_fs45_InitConfig.<a class="code" href="structfs45__drv__config__t.html#a1ad58016ff5dbf417ee01f2927ba5999">fssmReg</a>.<a class="code" href="structfs45__fssm__reg__t.html#ac537c3225d3f5fd3e34b6309200dab2f">io23Fs</a> = <a class="code" href="sbc__fs45__map_8h.html#a481f29138f94636c0facac50631b8f5d">FS45_R_FS_IO_23_FS_NOT_SAFETY</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Get default values of non-init registers - only a subset can be configured too. */</span></div>
<div class="line">    <a class="code" href="group__sbc__fs45__driver.html#ga9c1eb3309879eedc7b5c5daa2b6c6d98">FS45_GetDefaultNonInitRegsConfig</a>(&amp;sbc_fs45_InitConfig, nonInitConfig);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Change default non-init register values if needed. */</span></div>
<div class="line">    <span class="comment">/* Set watchdog window to 512 ms. */</span></div>
<div class="line">    sbc_fs45_InitConfig.<a class="code" href="structfs45__drv__config__t.html#a9c2a592b9654cb220e02cbd18c7691f1">nonInitRegs</a>[3].<a class="code" href="structfs45__reg__config__value__t.html#a638e4503e0ae6ce655b7ad2e17e8f0ad">value</a> = <a class="code" href="sbc__fs45__map_8h.html#a6bea9f8fcfb77d6eacb4b132fba14d19">FS45_R_FS_WD_WINDOW_512MS</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Initialize the SBC. */</span></div>
<div class="line">    status = <a class="code" href="group__sbc__fs45__driver.html#ga94ef42b557def41c941d565fc733f4af">FS45_Init</a>(&amp;sbc_fs45_InitConfig, INST_LPSPICOM1, SPI_COMM_TIMEOUT_MS);</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="status_8h.html#af9bff8ff1154a04a899276af806b8586a83da0606125c0dc2fe0544cb2c383cb9">STATUS_SUCCESS</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Error. */</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Start timer for watchdog refresh. */</span></div>
<div class="line">    WD_TIMER_START();</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --> <h2>Integration guideline</h2>
<h3>Compilation units</h3>
<p>The following files need to be compiled in the project: </p><pre class="fragment">${S32SDK_PATH}\middleware\sbc\sbc_fs45\source\sbc_fs45_driver.c
</pre><h3>Include path</h3>
<p>The following paths need to be added to the include path of the toolchain: </p><pre class="fragment">${S32SDK_PATH}\middleware\sbc\sbc_fs45\include
</pre><h3>Compile symbols</h3>
<p>No special symbols are required for this component</p>
<h3>Dependencies</h3>
<p><a class="el" href="group__lpspi.html">Low Power Serial Peripheral Interface (LPSPI)</a> <a class="el" href="group__osif.html">OS Interface (OSIF)</a> </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__sbc__fs45__driver"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sbc__fs45__driver.html">SBC FS45 Driver</a></td></tr>
<tr class="memdesc:group__sbc__fs45__driver"><td class="mdescLeft">&#160;</td><td class="mdescRight">SBC FS45 driver. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Jun 11 2021 08:16:21 for S32 SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
